# instance configuration for template 'logentry'
apiVersion: "config.istio.io/v1alpha2"
kind: logentry
metadata:
  name: octarinelog
  namespace: istio-system
spec:
  severity: '"Default"'
  timestamp: request.time
  variables:
    sourceIp: source.ip | ip("0.0.0.0")
    sourceAddress: source.service | ""
    # sourcePort: source.port | 0
    sourceName: source.name | ""
    sourceUid: source.uid | ""
    sourceNamespace: source.namespace | ""
    destinationIp: destination.ip | ip("0.0.0.0")
    destinationAddress: destination.service | ""
    # destinationPort: destination.port | 0
    destinationName: destination.name | ""
    destinationUid: destination.uid | ""
    destinationNamespace: destination.namespace | ""
    protocol: request.scheme | ""
    method: request.method | ""
    endpoint: request.path | ""
    code: response.code | 0
    responseDuration: response.duration | "0ms"
  monitored_resource_type: '"UNSPECIFIED"'
---
# handler configuration for adapter 'logentry'
apiVersion: "config.istio.io/v1alpha2"
kind: octarine
metadata:
  name: octarinehandler
  namespace: istio-system
spec:
  flagsFile: "/octarine_id/gflags"
---
# rule to dispatch to your handler
apiVersion: "config.istio.io/v1alpha2"
kind: rule
metadata:
  name: octarinerule
  namespace: istio-system
spec:
  match: "true"
  actions:
  - handler: octarinehandler.octarine
    instances:
    - octarinelog.logentry
